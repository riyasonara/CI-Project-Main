@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "_navigationSidebar";
}

@model CI_Platform_Project.Models.AdminBannerViewModel;


<html>
<head>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" />

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
    <link rel="stylesheet" href="~/css/AdminMissions.css" />

    <link href="~/lib/dropzone/dist/min/dropzone.min.css" rel="stylesheet" />

</head>
<body>
    <div class="container-fluid">
        <div class="fs-4">
            Banner
        </div>

        <div class="row mt-1">
            <hr class="col-2" style="border: 2px solid black;">
            <hr class="col-10 ">
        </div>

        <div class="button-row mb-3">
            <div class=" start-btn">

                <input class="form-control me-2" id="myInputTextField" type="search" placeholder="Search" aria-label="Search">
            </div>

            <div class="end-btn">
                <button type="button" class="btn btn-outline-warning rounded-pill px-3 py-0 me-2" data-bs-toggle="modal" data-bs-target="#AddModal">
                    <i class="bi bi-plus-lg "></i> <span class="btn-label">Add</span>
                </button>
            </div>
            <!-- Modal -->
            <form action="" method="post" enctype="multipart/form-data">
                <div class="modal fade" id="AddModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-centered">

                        <div class="modal-content">

                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>

                            <div class="modal-body">
                                <div class="fs-5 bg-dark-subtle border p-3 col-12"> Add</div>

                                <div class="border ps-4 pb-5">

                                    <label class="mt-3">Select Banner Image</label>
                                    <div class="upload-btn-wrapper position-relative d-flex justify-content-center col-md-12" onclick="CLICK()">
                                        @if (Model.img == null)
                                        {
                                            <img src="~/img/Grow-Trees-On-the-path-to-environment-sustainability.png" class="user-profile-image" id="imgTag" />
                                        }
                                        else
                                        {
                                            <img src="@Model.img" class="user-profile-image" id="imgTag" />
                                        }

                                        <button class="btn-edit-image"><i class="bi bi-person-bounding-box change-image-icon" style="color:black;"></i></button>
                                        <div id="refresh-profile-image-div">
                                            <input type="hidden" asp-for="BannerId" id="bannerId" />
                                            <input type="file" style="display:none;" id="imginput" onchange="CHANGE(event)" />
                                        </div>
                                    </div>


                                    <label class="mt-2">Description</label>
                                    <div class="col-12 mt-2">
                                        <textarea class="col-12" id="Desc" asp-for="Description"></textarea>
                                    </div>


                                    <label class="mt-2">Sort Order Value</label>
                                    <div class="col-12 mt-2">
                                        <textarea class="col-12" id="sortorder" asp-for="BannerSortOrder"></textarea>
                                    </div>


                                </div>



                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn border-secondary rounded-pill" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn oran" onclick="savebanner()" data-bs-dismiss="modal">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <!--end of modal-->
        </div>
        <table id="userTable">
            <thead>
                <tr>
                    <th>Banner Image</th>
                    <th>Description</th>
                    <th>Sort Order Value</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                @if (Model.banners != null)
                {
                    @foreach (var banner in Model.banners)
                    {
                        <tr>
                            <td><img src="@banner.Image" id="cardBanner" /></td>
                            <td class="text-break">@banner.Text</td>
                            <td>@banner.SortOrder</td>

                            <td>

                                <span>
                                    <button class="btn shadow-none" @*onclick="approve(@applications.MissionApplicationId)*@">
                                        <i class="bi bi-check-circle fs-5" style="color:green;"></i>
                                    </button>
                                </span>
                                <span>
                                    <button class="btn shadow-none" @*onclick="reject(@applications.MissionApplicationId)*@">
                                        <i class="bi bi-x-circle fs-5" style="color:red;"></i>
                                    </button>
                                </span>

                            </td>
                        </tr>
                    }
                }


            </tbody>
        </table>

    </div>
    </div>
</body>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>
<script>
    function deletebanner(bannerId) {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: true
        })

        swalWithBootstrapButtons.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this goalsheet!",
            icon: 'warning',
            width: '300',
            height: '100',
            showCancelButton: true,
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/Admin/Admin/DeleteBanner',
                    type: 'POST',
                    data: { bannerId: bannerId },

                    success: function (response) {

                        swalWithBootstrapButtons.fire(
                            'Deleted!',
                            'Your goalsheet has been deleted.',
                            'success'
                        )
                        $('#example').html($(response).find('#example').html());
                        location.reload();


                    },
                    error: function () {
                        alert("could not comment");
                    }
                });

            } else if (
                / Read more about handling dismissals below /
                                                result.dismiss === Swal.DismissReason.cancel
                                            ) {
            swalWithBootstrapButtons.fire(
                'Cancelled',

            )
        }
    })

    function CLICK() {

        document.getElementById("imginput").click();
    }
    function CHANGE(event) {
        const reader = new FileReader(); // Create a new FileReader object
        reader.onload = function () {
            document.getElementById('imgTag').src = reader.result; // Set the source of the image tag to the selected image
        }
        reader.readAsDataURL(event.target.files[0]);         // Read the selected file as a data URL
    }
    function savebanner() {
        if (document.getElementById("description").value != "" || sortorder: document.getElementById("sortorder").value) {
            $.ajax({
                url: '/Admin/Admin/AddBanner',
                type: 'POST',
                data: {
                    description: document.getElementById("description").value,
                    bannerId: document.getElementById("bannerId").value,
                    image: document.getElementById("imgTag").src,
                    sortorder: document.getElementById("sortorder").value,

                },

                success: function (response) {

                    //document.getElementById("themeName").value = response.title;
                    $('#AdminBannerModalmodal').html($(response).find('#AdminBannerModalmodal').html());
                    location.reload();
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Email already exists',
                        timer: 2500,
                    })
                }
            });
        }
    }
    function getBanner(id) {
        $.ajax({
            url: '/Admin/Admin/GetBanner',
            type: 'POST',
            data: {
                bannerId: id
            },

            success: function (response) {

                //document.getElementById("themeName").value = response.title;
                $('#AdminBannerModalmodal').html($(response).find('#AdminBannerModalmodal').html());

            },
            error: function () {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Email already exists',
                    timer: 2500,
                });
            }
        });
    }
</script>


<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script src="~/js/Admin.js" asp-append-version="true"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
</html>